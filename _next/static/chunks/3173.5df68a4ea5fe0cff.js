"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3173],{23173:function(e,t,s){s.r(t),s.d(t,{default:function(){return Staking_StakingDrawer}});var a=s(85893),n=s(67294),l=s(2593),i=s(94398),r=s(17931);let Slider=e=>{let{className:t,label:s,max:n,min:l=0,step:d=1,onChange:o,value:c,is_percentage:m}=e;return(0,a.jsxs)("div",{className:"".concat(t||""),children:[(0,a.jsx)("label",{htmlFor:"default-range",className:"block mb-2 text-sm font-medium text-secondary",children:s}),(0,a.jsxs)("div",{className:"bg-level-two rounded-lg flex space-x-4 items-center",children:[(0,a.jsx)(i.Range,{step:d,min:l,max:n,values:[Number(c)],onChange:e=>o(e[0]),renderTrack:e=>{let{props:t,children:s}=e;return(0,a.jsx)("div",{...t,style:{...t.style,height:"0.5rem",width:"100%",backgroundColor:r.hr,borderRadius:r.GN},children:s})},renderThumb:e=>{let{props:t}=e;return(0,a.jsx)("div",{...t,style:{...t.style,height:"1rem",width:"1rem",borderRadius:r.GN,backgroundColor:r.lS}})}}),m&&(0,a.jsxs)("div",{className:"w-12",id:"slider",children:[c,"%"]})]})]})};var d=s(61267),o=s(30765),c=s(68851),m=s(10721),u=s(59850),x=s(91328),h=s(41421),v=s(17106);let p=function(e){e=null==e?void 0:e.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,function(e,t,s,a){return t+t+s+s+a+a});let t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:null}(r.hr),DrawerContainer=e=>{let{children:t}=e,[s,l]=(0,n.useState)(!1),i=(0,m.TL)(),{staking_modal_open:r}=(0,m.CG)(e=>e.staking);return(0,a.jsx)(v.u,{"data-testid":"transition",show:r,enter:"transition-opacity duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"transition-opacity duration-300",leaveFrom:"opacity-100",leaveTo:"opacity-0",className:"min-w-screen fixed left-0 top-0 flex justify-center items-center inset-0 z-50 outline-none focus:outline-none text-white overflow-auto",style:{backgroundColor:"rgb(".concat(p.r,", ").concat(p.g,", ").concat(p.b,", 0.8)")},onMouseDown:()=>{s||(i((0,c.q5)(!1)),setTimeout(()=>i((0,c.hr)("Deposit")),300))},children:(0,a.jsx)(v.u.Child,{"data-testid":"transition-child",className:"relative text-primary w-full max-w-screen sm:max-w-sm relative ml-auto my-auto shadow-lg bg-dcb min-h-screen border-l-2 border-custom bg-level-one",enter:"transition ease-in-out duration-300 transform",enterFrom:"translate-x-full",enterTo:"translate-x-0",leave:"transition ease-in-out duration-300 transform",leaveFrom:"translate-x-0",leaveTo:"translate-x-full",onMouseEnter:()=>l(!0),onMouseLeave:()=>l(!1),id:"staking-modal",children:t})})};var g=s(62378),j=s(42812),f=s(80132),b=s(22920),y=s(5866),N=s(62374);let Bounty=()=>{let[e,t]=(0,n.useState)(!1),{account:s}=(0,j.l)(),{current_pool:l,pools:i}=(0,m.CG)(e=>e.staking),r=(0,m.TL)(),[{connectedChain:d},o]=(0,f.Um)(),[x,v]=(0,n.useState)(!1),{contract_idx:p,vault:w,id:k,chain_id:C}=i.find(e=>{let{id:t}=e;return t===l}),[_]=(0,m.C)(w,u.R.Vault,!0),handleClaim=async()=>{let e=await _.estimateGas.harvest(p,{gasLimit:"5000000"});t(!0);try{await (0,h.n2)(_.harvest(p,{gasLimit:e.mul(12).div(10)}),"Successfully claimed bounty from pool",async()=>{r((0,c.nh)(k,s))}),t(!1)}catch(e){b.Am.error(e.reason||e.message),t(!1)}},S=C!==parseInt(null==d?void 0:d.id),setCorrectChainId=()=>{C!==parseInt(null==d?void 0:d.id)?(v(!0),o({chainId:"0x"+C.toString(16)})):v(!1)};return(0,a.jsx)(a.Fragment,{children:S?(0,a.jsx)(N.v,{message:"You can't stake in this pool.",sub_message:"Please connect to the right chain to continue",handleClick:()=>setCorrectChainId(),button_text:"Switch to ".concat(y.g[C].network_name),loading:x}):(0,a.jsx)(g.zx,{className:"w-full",disabled:e,onClick:handleClaim,loading:e,id:"claim-bounty-btn",children:(0,a.jsx)("strong",{children:"Claim bounty"})})})};var w=s(35553),k=s(27484),C=s.n(k),_=s(59860),S=s(85063);let useStakingMethods=()=>{let[e,t]=(0,n.useState)(!1),{account:s}=(0,j.l)(),{current_pool:a,pools:i,deposit_amount:r,second_deposit_amount:o,selected_ids:v,withdraw_percent:p}=(0,m.CG)(e=>e.staking),g=i.find(e=>{let{id:t}=e;return t===a}),{address:f,type:y}=g,N=y===x.W.Compound,[w]=(0,_.C)(f,d.XH[g.type],!0),[k]=(0,_.C)(g.vault,u.R.Vault,!0),C=N?k:w,T=(0,m.TL)(),handleDeposit=async()=>{t(!0);let[e,a]=(0,S.Fg)(g,r,o,v),n=a.slice(0,a.length-1),i=a[a.length-1];try{let t=l.O$.from(5e5);await (0,h.n2)(C[e](...n,{...i,gasLimit:t}),"Transaction successfully complete"),T((0,c.nh)(null==g?void 0:g.id,s)),T((0,c.e4)("0")),T((0,c.Ge)("0"))}catch(e){b.Am.error(e.reason||e.message)}t(!1)},handleWithdraw=async()=>{t(!0);let[e,a]=(0,S.eR)(g,v,Number(p));try{let t=l.O$.from(5e5);await (0,h.n2)(C[e](...a,{gasLimit:t}),"Transaction successfully complete"),T((0,c.nh)(null==g?void 0:g.id,s)),T((0,c.hr)("Deposit"))}catch(e){b.Am.error(e.reason||e.message)}t(!1)};return{handleDeposit,handleWithdraw,loading:e}},LiquidityDeposit=()=>{let{account:e}=(0,j.l)(),{current_pool:t,pools:s,deposit_amount:n="0",second_deposit_amount:i="0"}=(0,m.CG)(e=>e.staking),{input_token:r,second_input_token:o,type:c,end_date:u,is_native:[x,v],address:p,chain_id:b}=s.find(e=>{let{id:s}=e;return s===t}),[y,N]=(0,m.C)(p,d.XH[c],!0),k=0===Number(n),_=(0,w.vz)((0,h.T7)(n||"0"),r.decimals),S=(0,w.vz)((0,h.T7)(i||"0"),o.decimals),{handleDeposit:T,loading:D}=useStakingMethods(),[{connectedChain:F}]=(0,f.Um)(),{approved:W,handleApprove:I,loading:z}=(0,m.A$)(r.address,e,N,_.toString()),{approved:L,handleApprove:M,loading:G}=(0,m.A$)(o.address,e,N,_.toString()),A=(0,m.mM)(r.address,b,x&&0===v),q=(0,m.mM)(o.address,b,x&&1===v),$=C()().isAfter(C()(u||new Date)),Y=l.O$.from(_).gt(A)||l.O$.from(S).gt(q),B=b!==parseInt(null==F?void 0:F.id),H=[[W,r,z,I],[L,o,G,M]].filter((e,t)=>!x||x&&v!==t);return(0,a.jsx)("div",{className:"flex space-x-2",children:H.filter(e=>{let[t]=e;return t}).length===H.length?(0,a.jsx)(g.zx,{className:"flex-1",disabled:D||$||k||Y||B,onClick:T,loading:D,id:"current-version",children:"Deposit"}):H.map((e,t)=>{let[s,n,l,i]=e;return(0,a.jsxs)(g.zx,{className:"flex-1",loading:l,disabled:l||s||B,onClick:i,children:[H.length>1&&"".concat(t+1,". "),"Enable ",n.symbol]},"".concat(n.symbol,"-").concat(t))})})},NFTDeposit=()=>{let{account:e}=(0,j.l)(),{current_pool:t,pools:s,selected_ids:n}=(0,m.CG)(e=>e.staking),l=s.find(e=>{let{id:s}=e;return s===t}),{input_token:i,end_date:r,address:d}=l,{address:o}=i,{handleDeposit:c,loading:u}=useStakingMethods(),{approved:x,handleApprove:h,loading:v}=(0,m.bv)(o,e,d),p=C()().isAfter(C()(r||new Date));return(0,a.jsxs)("div",{className:"flex space-x-2",children:[(0,a.jsx)(g.zx,{className:"flex-1",loading:v,disabled:v||p||x,onClick:h,id:"enable-btn",children:"1. Enable"}),(0,a.jsx)(g.zx,{className:"flex-1",disabled:u||p||!x||0===n.length,onClick:c,loading:u,id:"deposit-btn",children:"2. Deposit"})]})},StandardDeposit=()=>{let{account:e}=(0,j.l)(),{current_pool:t,pools:s,deposit_amount:n}=(0,m.CG)(e=>e.staking),i=s.find(e=>{let{id:s}=e;return s===t}),{input_token:r,type:d,end_date:o,address:c}=i,u=(0,m.mM)(r.address,i.chain_id),{decimals:v,address:p}=r,f=0===Number((0,h.T7)(n||"0")),b=(0,w.vz)((0,h.T7)(n||"0"),v),{handleDeposit:y,loading:N}=useStakingMethods(),{approved:k,handleApprove:_,loading:S}=(0,m.A$)(p,e,d===x.W.Compound?i.vault:c,b.toString()),T=C()().isAfter(C()(o||new Date)),D=l.O$.from(b),F=D.gt(u),W=T||f||F;return(0,a.jsxs)("div",{className:"flex space-x-2",children:[(0,a.jsx)(g.zx,{className:"flex-1",loading:S,disabled:S||W||k,onClick:_,id:"enable-btn",children:"1. Enable"}),(0,a.jsx)(g.zx,{className:"flex-1",disabled:N||W||!k,onClick:y,loading:N,id:"deposit-btn",children:"2. Deposit"})]})},Deposit=()=>{let{current_pool:e,pools:t}=(0,m.CG)(e=>e.staking),{type:s,has_stake:l,chain_id:i}=t.find(t=>{let{id:s}=t;return s===e}),[r,d]=(0,n.useState)(!!l),[o,c]=(0,n.useState)(!1),[{connectedChain:u},h]=(0,f.Um)(),setCorrectChainId=()=>{i!==parseInt(null==u?void 0:u.id)&&(c(!0),h({chainId:"0x"+i.toString(16)}),c(!1))},v=i!==parseInt(null==u?void 0:u.id);return(0,a.jsx)(a.Fragment,{children:r&&!v?(0,a.jsx)(N.v,{message:"You are already staking in this pool.",sub_message:"Staking more in this pool will increase your rewards but will also extend the lock end date.",handleClick:()=>d(!1),button_text:"Continue"}):v?(0,a.jsx)(N.v,{message:"You can't stake in this pool.",sub_message:"Please connect to the right chain to continue",handleClick:()=>setCorrectChainId(),button_text:"Switch to ".concat(y.g[i].network_name),loading:o}):(0,a.jsx)(a.Fragment,{children:(e=>{switch(e){case x.W.NFT:return(0,a.jsx)(NFTDeposit,{});case x.W.Liquidity:return(0,a.jsx)(LiquidityDeposit,{});default:return(0,a.jsx)(StandardDeposit,{})}})(s)})})},T={[x.W.Dynamic]:"claim",[x.W.Liquidity]:"claim",[x.W.NFT]:"claimAndRestake"},Withdraw=()=>{let[e,t]=(0,n.useState)(!1),[{connectedChain:s},i]=(0,f.Um)(),[r,o]=(0,n.useState)(!1),{account:u}=(0,j.l)(),v=(0,m.TL)(),{current_pool:p,pools:b,selected_ids:w}=(0,m.CG)(e=>e.staking),{id:k,user_stake:_,type:S,can_claim:D,contract_idx:F,last_user_deposit:W,lock_period:I,address:z,is_withdraw_locked:L,chain_id:M}=b.find(e=>{let{id:t}=e;return t===p}),[G]=(0,m.C)(z,d.XH[S],!0),{handleWithdraw:A,loading:q}=useStakingMethods(),handleClaim=async()=>{t(!0),await (0,h.n2)(G[T[S]](F),"Successfully claimed rewards from pool",async()=>{v((0,c.nh)(k,u))}),t(!1)},$=x.W.Dynamic===S,Y=x.W.NFT===S,B=x.W.Liquidity===S,H=Y&&0===w.length,O=!Y&&l.O$.from(_).eq(0),R=C()().subtract(parseInt(I),"days").isAfter(C()(W)),E=[x.W.NFT,x.W.Liquidity,x.W.Dynamic].includes(S),U=O||H||[x.W.Liquidity].includes(S)&&L&&!R||$&&!R,V=M!==parseInt(null==s?void 0:s.id),setCorrectChainId=()=>{M!==parseInt(null==s?void 0:s.id)?(o(!0),i({chainId:"0x"+M.toString(16)})):o(!1)};return(0,a.jsx)(a.Fragment,{children:V?(0,a.jsx)(N.v,{message:"You can't stake in this pool.",sub_message:"Please connect to the right chain to continue",handleClick:()=>setCorrectChainId(),button_text:"Switch to ".concat(y.g[M].network_name),loading:r}):(0,a.jsxs)("div",{className:"flex space-x-2",children:[E&&(0,a.jsxs)(g.zx,{className:"flex-1",loading:e,disabled:e||!(D||B&&L||$),onClick:handleClaim,children:["Claim",Y&&" & relock"]}),(0,a.jsx)(g.zx,{className:"flex-1",disabled:q||U,onClick:A,loading:q,id:"withdraw-btn",children:"Withdraw"})]})})},render=e=>{switch(e){case"Bounty":return(0,a.jsx)(Bounty,{});case"Withdraw":return(0,a.jsx)(Withdraw,{});default:return(0,a.jsx)(Deposit,{})}},Footer=()=>{let{connect:e,account:t}=(0,j.l)(),{modal_state:s}=(0,m.CG)(e=>e.staking);return(0,a.jsx)("div",{className:"w-full bg-level-two p-4 absolute bottom-0 border-t border-custom border-opacity-[0.03]",children:t?render(s):(0,a.jsx)(g.zx,{className:"w-full",onClick:()=>e(void 0),children:"Connect wallet"})})};var D=s(93515),F=s(58974),W=s(41664),I=s.n(W);let NoNFTS=e=>{let{url:t="",text:s,className:n=""}=e,{connect:l}=(0,j.l)();return(0,a.jsx)("div",{className:"w-full flex items-center justify-center text-center p-5 ".concat(n),children:(0,a.jsxs)("div",{children:[(0,a.jsx)("img",{src:"/icons/no-nfts.svg",className:"mx-auto my-8",alt:"Staked all NFTs"}),(0,a.jsx)("h3",{className:"text-lg text-primary my-8",children:(0,a.jsx)("strong",{children:s})}),(0,a.jsx)(I(),{href:t,target:"_blank",rel:"noopener,noreferrer",children:(0,a.jsx)(g.zx,{className:"w-full",children:"Get NFTs"})}),(0,a.jsx)("p",{className:"my-8 text-secondary underline cursor-pointer",onClick:()=>l(void 0),children:"Change wallet"})]})})},InputItem=e=>{let{nft:{id:t,data:s},selected_ids:l,max_per_user:i,num_staked:r,available:d}=e,[o,u]=(0,n.useState)(!0),x=(0,n.useMemo)(()=>l.includes(t),[t,l]),h=(0,m.TL)();return(0,a.jsxs)("div",{className:"text-left",id:"NFT selector",children:[(0,a.jsxs)("div",{className:"relative rounded cursor-pointer ".concat(x?"border border-accent":""),onClick:()=>{if(l.includes(t)){h((0,c.oT)(l.filter(e=>e!==t)));return}d&&r+l.length>=i||h((0,c.oT)([...l,t]))},children:[(0,a.jsx)("img",{src:s,alt:t.toString(),className:"rounded w-full bg-main aspect-square ".concat(o?"animate-pulse":""),onLoad:()=>u(!1)}),x&&(0,a.jsx)("div",{className:"absolute top-2 left-2 border border-custom rounded",children:(0,a.jsx)(F.J,{className:"text-accent"})})]}),(0,a.jsxs)("p",{className:"text-secondary",children:["#",t]})]})},NFTSelect=e=>{let{pool:t,available:s=!0}=e,{selected_ids:n}=(0,m.CG)(e=>e.staking),l=t[s?"available_tokens":"staked_tokens"];return l.length>0?(0,a.jsx)("div",{className:"grid grid-cols-2 gap-2 max-h-72 overflow-scroll",children:l.map(e=>(0,a.jsx)(InputItem,{nft:e,selected_ids:n,max_per_user:t.max_per_user,num_staked:t.staked_tokens.length,available:s},"nft-input-".concat(e.id)))}):(0,a.jsx)(NoNFTS,{text:"You are staking all of your available NFTs",url:t.collection_url})};var z=s(75605);let NumberInput=e=>{let{pool:t,reserves:s}=e,i=(null==t?void 0:t.chain_id)||r.Kj,d=r.k3[i],{symbol:o,decimals:u}=d||{symbol:"",decimals:18},[v,p]=(0,n.useState)(!1),{loading:g,deposit_amount:j}=(0,m.CG)(e=>e.staking),f=(0,m.TL)(),{input_token:b,is_native:y=[!1,0]}=t,N=(0,m.mM)(b.address,t.chain_id,y[0]&&0===y[1]),{hardcap:k,total_staked:C}=t,{symbol:_=o,decimals:S=u}=(null==t?void 0:t.input_token)||{},setSecondDeposit=e=>{var a;let n=(0,w.vz)(e||"0",b.decimals).mul(s.reserve1).div(s.reserve0.eq(0)?1:s.reserve0);f((0,c.Ge)((0,w.bM)(n,(null===(a=t.second_input_token)||void 0===a?void 0:a.decimals)||18)))},T=t.type===x.W.Liquidity,D=(0,w.vz)(j||"0",b.decimals),F=D.gt(N);return(0,a.jsxs)("div",{className:"text-left",children:[(0,a.jsx)("div",{className:"w-full",children:(0,a.jsx)(z.II,{loading:g,err_border:F,value:j,onChange:e=>{let t=e.target.value;f((0,c.e4)(t.toString())),T&&setSecondDeposit(t.toString())},surface:"zero",handleMaxClick:()=>{let e=l.O$.from(k).sub(C),t=T?N:l.O$.from(N).gt(e)?e:N,s=(0,w.vz)((0,h.T7)((0,h.am)(t,b.decimals)),b.decimals).toString(),a=(0,h.Ff)(s,t.toString(),b.decimals);a=0>Number(a)?"0":a,f((0,c.e4)(a)),T&&setSecondDeposit(a)},unit:_,type:"number",is_initialized:v,onFocus:()=>p(!0)})}),(0,a.jsxs)("div",{className:"flex items-center mt-4 text-sm",children:[(0,a.jsx)("div",{className:"flex-1 text-sm text-secondary",children:"Available to stake"}),(0,a.jsx)("strong",{className:"".concat(F?"text-primary":""),children:"".concat((0,h.am)(N,S)," ").concat(_)})]})]})},SecondNumberInput=e=>{let{pool:t,reserves:s}=e,{symbol:l,decimals:i}=r.k3[t.chain_id],{loading:d,second_deposit_amount:o}=(0,m.CG)(e=>e.staking),[u,x]=(0,n.useState)(!1),v=(0,m.TL)(),p=(0,m.mM)(t.second_input_token.address,t.chain_id,t.is_native[0]&&1===t.is_native[1]),{symbol:g=l,decimals:j=i}=(null==t?void 0:t.second_input_token)||{},setFirstDepositAmount=e=>{let a=s.reserve1.eq(0),n=(0,w.vz)(e||"0",j).mul(s.reserve0).div(a?1:s.reserve1);v((0,c.e4)((0,w.bM)(n,t.input_token.decimals)))},f=(0,w.vz)((0,h.T7)(o||"0"),j),b=f.gt(p);return(0,a.jsxs)("div",{className:"text-left mt-4",children:[(0,a.jsx)("div",{className:"w-full",children:(0,a.jsx)(z.II,{surface:"zero",loading:d,err_border:b,value:o,onChange:e=>{let t=e.target.value;v((0,c.Ge)(t.toString())),setFirstDepositAmount(t.toString())},handleMaxClick:()=>{let e=(0,w.vz)((0,h.T7)((0,h.am)(p,j)),j).toString(),t=(0,h.Ff)(e,p);v((0,c.Ge)(t)),setFirstDepositAmount(t)},unit:g,type:"number",onFocus:()=>x(!0),is_initialized:u})}),(0,a.jsxs)("div",{className:"flex items-center mt-4 text-sm",children:[(0,a.jsx)("div",{className:"flex-1 text-sm text-secondary",children:"Available to stake"}),(0,a.jsx)("strong",{className:"".concat(b?"text-primary":""),children:"".concat((0,h.am)(p,j)," ").concat(g)})]})]})},Input=e=>{let{pool:t}=e;if(t.type===x.W.NFT)return(0,a.jsx)(NFTSelect,{pool:t});let s=(0,D.m)(t.pair,t.chain_id);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(NumberInput,{pool:t,reserves:s}),t.type===x.W.Liquidity&&(0,a.jsx)(SecondNumberInput,{pool:t,reserves:s})]})};var L=s(73628),M=s(32790),StakingDrawer_ModalHeader=()=>{let e=(0,m.TL)(),{current_pool:t,pools:s}=(0,m.CG)(e=>e.staking),n=s.find(e=>{let{id:s}=e;return s===t}),l=n.type===x.W.NFT;return(0,a.jsxs)("div",{className:"h-40 relative overflow-hidden ".concat(l?"":"bg-staking-header"),children:[(0,a.jsx)("button",{"data-testid":"modal-header-btn",className:"absolute top-4 left-4 z-50",onClick:()=>{e((0,c.hr)("Deposit")),e((0,c.q5)(!1))},children:(0,a.jsx)(L.X1,{})}),(0,a.jsx)("img",{src:y.g[n.chain_id].network_logo,width:32,height:32,className:"absolute right-4 top-4"}),!l&&(0,a.jsx)(M.J,{pool:n,className:"absolute left-4 bottom-4"}),l&&(0,a.jsx)("h3",{className:"absolute left-4 bottom-4 text-2xl z-50",children:(0,a.jsx)("strong",{children:n.name})}),l&&(0,a.jsx)("img",{alt:n.name,src:n.header_logo,className:"w-full absolute"})]})},G=s(59927),A=s(88326);let TextItem=e=>{let{text:t,title:s,info:n,checked:l}=e;return(0,a.jsxs)("div",{className:"flex my-2",children:[(0,a.jsx)("div",{className:"flex-1 text-secondary",children:n?(0,a.jsx)(g.XU,{info:n,text:s}):s}),(0,a.jsx)("div",{className:"flex items-center space-x-2 ".concat(l?"text-success":""),children:(0,a.jsx)("strong",{children:t})})]})};var StakingDrawer_SummaryText=e=>{let{deposit_amount:t,withdraw_amount:s}=e,{current_pool:n,pools:i,modal_state:r,withdraw_percent:d}=(0,m.CG)(e=>e.staking),o=i.find(e=>{let{id:t}=e;return t===n}),{id:c,user_stake:u="0",earned_reward:v="0",has_stake:p,reward_rate:j="0",input_token:f,reward_token:b,type:y,is_withdraw_locked:N,last_user_deposit:k,lock_period:_}=o||{},T=l.O$.from((0,w.vz)((0,h.T7)(t||"0"),(null==f?void 0:f.decimals)||18)).add(u),D=y===x.W.Compound?(100*(0,A.WZ)(parseFloat(j)/100,365)).toFixed(2)+"%":j,F=y===x.W.Compound,W=y===x.W.NFT,I=y===x.W.Liquidity,z=y===x.W.Dynamic,L=C()().isAfter(C()(k).add(parseInt(_),"days")),M=I?d:100,{boost:q,has_boost:$}=(0,S.xS)(o);return(0,a.jsxs)(a.Fragment,{children:["Deposit"===r&&(0,a.jsxs)("div",{className:"my-8",children:[p&&W&&(0,a.jsx)(TextItem,{title:"Your stake",text:"".concat(u," / ").concat(o.max_per_user)}),(0,a.jsx)(TextItem,{title:"Lock period",text:_+" days"}),(0,a.jsx)(TextItem,{title:W?"Daily reward per NFT":"Reward",text:W?"".concat((0,h.am)(j)," ").concat(o.reward_token.symbol):D,info:z?"Annual percentage yield (APY). The percent will change depending on a total amount staked, but rewards can be claimed any time.":void 0}),!W&&(0,a.jsxs)("div",{className:"flex my-2",children:[(0,a.jsx)("div",{className:"flex-1 text-secondary",children:(0,a.jsxs)("div",{className:"flex items-center flex-wrap space-x-2",children:[(0,a.jsx)("p",{children:"NFT boost"}),(0,a.jsx)(G.P,{id:c,children:(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-accent",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})})]})}),(0,a.jsx)("div",{className:"flex items-center space-x-2 ".concat($?"text-success":""),children:(0,a.jsxs)("strong",{children:["+",$?q:0,"%"]})})]}),p&&!W&&(0,a.jsx)(TextItem,{title:"Stake after deposit",text:"".concat((0,h.am)(T.add(F?v:0),null==f?void 0:f.decimals)," ").concat(null==f?void 0:f.symbol)}),""!==k&&(0,a.jsx)(TextItem,{title:"Current lock end date",text:k?C()(k).add(parseInt(_),"days").format("HH:mm MMM DD, YYYY"):"None",info:"You can withdraw the deposited amount and rewards after the current lock date has expired."}),""!==_&&(0,a.jsx)(TextItem,{title:(p?"New l":"L")+"ock end date",text:C()().add(Number(_),"days").format("HH:mm MMM DD, YYYY"),info:"The lock period will be reset when you deposit additional tokens to this pool. This will become the new lock period."})]}),"Withdraw"===r&&(0,a.jsxs)("div",{className:"my-4",children:[!W&&(0,a.jsxs)("div",{className:"flex my-2",children:[(0,a.jsx)("div",{className:"flex-1",children:(0,a.jsx)("p",{className:"text-secondary",children:"Withdraw amount"})}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsx)("p",{children:(0,a.jsxs)("strong",{children:[(0,h.am)(s.mul(M).div(100),null==f?void 0:f.decimals)," ",null==f?void 0:f.symbol]})}),I&&(0,a.jsx)("p",{children:(0,a.jsxs)("strong",{children:[(0,h.am)(l.O$.from(o.second_user_stake).mul(M).div(100),null==o?void 0:o.second_input_token.decimals)," ",null==o?void 0:o.second_input_token.symbol]})})]})]}),(0,a.jsxs)("div",{className:"flex my-2",children:[(0,a.jsx)("div",{className:"flex-1",children:(0,a.jsx)("p",{className:"text-secondary",children:"Earned reward"})}),(0,a.jsx)("div",{children:(0,a.jsx)("p",{children:(0,a.jsxs)("strong",{children:[(0,h.am)(l.O$.from(v).mul(M).div(100),null==b?void 0:b.decimals)," ",null==b?void 0:b.symbol]})})})]}),!N&&!L&&(0,a.jsx)(g.v3,{children:"Withdrawing before the lock end date will yield no rewards."})]})]})},q=s(22425),StakingDrawer_Switch=e=>{let{bounty:t}=e,s=(0,m.TL)(),{current_pool:n,pools:l,modal_state:i}=(0,m.CG)(e=>e.staking),r=l.find(e=>{let{id:t}=e;return t===n}),d=r.has_stake&&(r.can_claim||[x.W.Liquidity,x.W.Dynamic].includes(r.type)||!r.is_withdraw_locked);return(0,a.jsxs)("div",{className:"bg-level-one flex rounded cursor-pointer text-sm ".concat("Deposit"===i&&"mb-4"||""),children:[(0,a.jsx)("div",{"data-testid":"deposit-div",onClick:()=>s((0,c.hr)("Deposit")),className:"flex-1 px-4 py-2 rounded border-2 border-level-one ".concat("Deposit"===i?"bg-level-two":"text-secondary bg-level-one"),children:"Deposit"===i?(0,a.jsx)("strong",{children:"Deposit"}):"Deposit"}),r.type===x.W.Compound&&t.gt(0)&&(0,a.jsx)("div",{"data-testid":"bounty-div",onClick:()=>s((0,c.hr)("Bounty")),className:"flex-1 px-4 py-2 rounded border-2 border-level-one ".concat("Bounty"===i?"bg-level-two":"text-secondary bg-level-one"),children:"Bounty"===i?(0,a.jsx)("strong",{children:"Bounty"}):"Bounty"}),(0,a.jsx)("div",{"data-testid":"withdraw-div",onClick:()=>d&&s((0,c.hr)("Withdraw")),className:"flex-1 px-4 py-2 rounded border-2 border-level-one ".concat("Withdraw"===i?"bg-level-two":"text-secondary bg-level-one"),children:(0,a.jsx)(q.u,{text:"You can withdraw the deposited amount and rewards after the lock date has expired.",active:!d,children:(0,a.jsxs)("div",{className:"flex items-center",children:[!d&&(0,a.jsx)("svg",{"data-testid":"svg",xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 pr-1",viewBox:"0 0 20 20",fill:"currentColor",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z",clipRule:"evenodd"})}),(0,a.jsx)("div",{className:"flex-1",children:"Withdraw"===i?(0,a.jsx)("strong",{children:"Withdraw"}):"Withdraw"})]})})})]})};let isNFTAndNoNFTs=e=>{let{type:t,available_tokens:s,staked_tokens:a}=e;return t===x.W.NFT&&0===s.length&&0===a.length},StakingDrawer_Bounty=e=>{let{bounty:t,price:s,chain_id:n}=e,l=t.mul(s).div(BigInt(10**r.k3[n].decimals).toString());return(0,a.jsxs)("div",{className:"pt-4 px-2",children:[(0,a.jsxs)("div",{className:"px-4 py-6 text-center bg-level-three rounded border border-custom",children:[(0,a.jsxs)("h3",{className:"text-primary text-2xl","data-testid":"bounty-value",children:[(0,h.am)(t,r.k3[n].decimals,6)," ",r.k3[n].symbol]}),(0,a.jsxs)("p",{className:"text-secondary",children:["~ ",(0,h.am)(l,18,6)," USD"]})]}),(0,a.jsx)("p",{className:"text-left text-sm text-secondary mt-4",children:"Claim bounty straight to your wallet and compound staking rewards for everyone in this pool."})]})};var Staking_StakingDrawer=()=>{let[e,t]=(0,n.useState)(l.O$.from(0)),[s,i]=(0,n.useState)(!0),h=(0,m.CG)(e=>{var t;return null==e?void 0:null===(t=e.staking)||void 0===t?void 0:t.deposit_amount})||"0",{current_pool:v,pools:p,modal_state:g,withdraw_percent:j}=(0,m.CG)(e=>e.staking),f=(0,m.TL)(),b=p.find(e=>{let{id:t}=e;return t===v}),{vault:y,contract_idx:N,chain_id:w}=p.find(e=>{let{id:t}=e;return t===v})||{},k=(0,m.pQ)(null!=w?w:r.Kj),C=(0,o.ti)(y,u.R.Vault,w),_=l.O$.from((null==b?void 0:b.user_stake)||0),S=(null==b?void 0:b.type)===x.W.Liquidity,T=(null==b?void 0:b.type)===x.W.NFT,D=(0,n.useMemo)(()=>isNFTAndNoNFTs(b||{}),[b]),onSliderChange=e=>{f((0,c.tV)(e))};return(0,n.useEffect)(()=>{if(d.qx||!C)return;s&&C&&(i(!1),C.calculateHarvestDcbRewards(N).then(e=>t(e)));let e=setInterval(()=>C.calculateHarvestDcbRewards(N).then(e=>t(e)),5e3);return()=>{clearInterval(e)}},[C,N]),(0,a.jsx)(DrawerContainer,{children:(0,a.jsxs)("div",{className:"pb-12",children:[(0,a.jsx)(StakingDrawer_ModalHeader,{}),D?(0,a.jsx)(NoNFTS,{text:"Looks like you don’t have any compatible NFTs to stake in this pool",className:"h-[32rem] p-10",url:b.collection_url}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"p-4",children:[(0,a.jsxs)("div",{className:"bg-level-two p-4 text-center rounded",children:[(0,a.jsx)(StakingDrawer_Switch,{bounty:e}),"Deposit"===g&&(0,a.jsx)(Input,{pool:b})||"Withdraw"===g&&T&&(0,a.jsx)("div",{className:"mt-4",children:(0,a.jsx)(NFTSelect,{pool:b,available:!1})}),"Withdraw"===g&&S&&(0,a.jsx)(Slider,{className:"mt-4",onChange:e=>onSliderChange(e),max:100,min:5,step:5,value:j.toString(),is_percentage:!0}),"Bounty"===g&&(0,a.jsx)(StakingDrawer_Bounty,{bounty:e,price:k,chain_id:w})]}),(0,a.jsx)(StakingDrawer_SummaryText,{deposit_amount:h,withdraw_amount:_})]}),(0,a.jsx)(Footer,{})]})]})})}}}]);